kind: Pod
metadata:
  name: agent
spec:
  containers:
    - name: tpkg
      image: 465068080952.dkr.ecr.eu-west-1.amazonaws.com/jenkins-console-toolchain:20210908093204
      command:
        - cat
      tty: true
      env:
        - name: DOCKER_HOST
          value: tcp://localhost:2375
      resources:
        requests:
          memory: "4G"
          cpu: "3"
        limits:
          cpu: "7"
          memory: "16G"
      volumeMounts:
        - mountPath: /go/pkg/mod
          name: go-cache-volume
    - name: dind-daemon
      image: 465068080952.dkr.ecr.eu-west-1.amazonaws.com/jenkins-dind:20.10.3-dind
      securityContext:
        privileged: true
      env:
        - name: DOCKER_TLS_CERTDIR
          value: ""
      volumeMounts:
        - name: docker-graph-storage
          mountPath: /var/lib/docker
  initContainers:
    - name: volume-permissions
      image: 465068080952.dkr.ecr.eu-west-1.amazonaws.com/jenkins-busybox:20210216225644
      command: ["sh", "-c", "chmod -R 777 /go/pkg/mod"]
      volumeMounts:
        - mountPath: /go/pkg/mod
          name: go-cache-volume
  volumes:
    - name: docker-graph-storage
      emptyDir: {}
    - name: go-cache-volume
      hostPath:
        path: /data/go-cache/
        type: DirectoryOrCreate
